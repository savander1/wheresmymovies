var __extends=this&&this.__extends||function(e,r){function t(){this.constructor=e}for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o]);e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)},Movie=function(){function e(){}return e}(),Display;!function(e){e[e.Show=0]="Show",e[e.Hide=1]="Hide"}(Display||(Display={}));var Controller=function(){function e(e){this.address=e}return e.prototype.error=function(e){console.log(e)},e}(),SearchController=function(e){function r(r){e.call(this,r)}return __extends(r,e),r}(Controller),MovieController=function(e){function r(r){e.call(this,r)}return __extends(r,e),r.prototype.get=function(e,r){var t=$("#id").val(),o=$("#title").val();$.ajax({type:"GET",url:this.address,data:{name:o,id:t},success:function(r){e(r)},error:function(e,t,o){r(e,t,o)}})},r.prototype.post=function(e,r,t){console.log(e),$.ajax({type:"POST",url:this.address,data:e,success:function(e){r(e)},error:function(e,r,o){t(e,r,o)}})},r}(Controller),AuthController=function(e){function r(r){e.call(this,r)}return __extends(r,e),r}(Controller),App=function(){function e(e,r,t){searchController=e,authController=t,movieController=r}return e.setImage=function(e){var r=$('<img id="posterImg">');return r.attr("src",e),r},e.canPopulateForm=function(){return""!==$("#id").val()||""!==$("#title").val()},e.populateForm=function(){movieController.get(function(r){$("#id").val(r.Id),$("#title").val(r.Title),$("#year").val(TimeFormatter.formatYear(r.Year)),$("#released").val(TimeFormatter.formatReleaseDate(r.Released)),$("#runtime").val(TimeFormatter.formatRuntime(r.Runtime)),$("#genre").val(r.Genre),$("#rated").val(r.Rated),$("#director").val(r.Director),$("#writer").val(r.Writer),$("#language").val(r.Language),$("#country").val(r.Country),$("#location").val(r.Location),$("#plot").text(r.Plot);var t=e.setImage(r.FullImgUrl),o=$("#poster");o.html(""),t.appendTo(o),$("form img").addClass("hide")},function(e,r,t){movieController.error(e.responseText),movieController.error(r),movieController.error(t),$("form img").addClass("hide")})},e.clearForm=function(){$("#id").val(""),$("#title").val(""),$("#year").val(""),$("#released").val(""),$("#runtime").val(""),$("#genre").val(""),$("#rated").val(""),$("#director").val(""),$("#writer").val(""),$("#language").val(""),$("#country").val(""),$("#location").val(""),$("#plot").text(""),$("#poster").html("")},e.killEvent=function(e){e.stopPropagation(),e.preventDefault()},e.getMovie=function(){var e=new Movie;return e.Id=$("#id").val(),e.Title=$("#title").val(),e.Year=$("#year").val(),e.Released=$("#released").val(),e.Runtime=$("#runtime").val(),e.Genre=$("#genre").val(),e.Rated=$("#rated").val(),e.Director=$("#director").val(),e.Writer=$("#writer").val(),e.Language=$("#language").val(),e.Country=$("#country").val(),e.Location=$("#location").val(),e.Plot=$("#plot").text(),e.FullImgUrl=$("#posterImg").attr("src"),e},e.showForm=function(r,t){e.killEvent(r);var o=$("body > div form"),n="hide";t===Display.Show&&(n="show"),o.removeAttr("class"),o.addClass(n)},e.clear=function(r){$("form img").addClass("hide"),e.killEvent(r),e.clearForm()},e.check=function(r){e.killEvent(r),e.canPopulateForm()?($("form img").addClass("show"),e.populateForm()):alert("Enter an ID or Title")},e.close=function(r){e.clear(r),e.showForm(r,Display.Hide)},e.submit=function(r){e.killEvent(r),$("form img").addClass("show");var t=e.getMovie();movieController.post(t,function(){e.clear(r),e.showForm(r,Display.Hide)},function(e,r,t){movieController.error(e.responseText),movieController.error(r),movieController.error(t),alert("There was a problem with your request: "+t),$("form img").addClass("hide")})},e.prototype.init=function(){$("#add").click(function(r){e.showForm(r,Display.Show)}),$("#check").click(e.check),$("#clear").click(e.clear),$("#close").click(e.close),$("#submit").click(e.submit)},e}(),TimeFormatter=function(){function e(){}return e.formatYear=function(e){if(0===e.length)return"";if(1===e.length)return e[0].toString();var r=e[0].toString(),t=e[e.length-1].toString();return r+"-"+t},e.formatReleaseDate=function(e){if(void 0===e)return"";var r={weekday:"long",year:"numeric",month:"long",day:"numeric"};return new Date(e).toLocaleDateString("en-US",r)},e.formatRuntime=function(e){if(void 0===e)return"";var r=e.split(":");if(3!==r.length)throw"Invalid Runtime: "+e;var t=60*+r[0],o=+r[1],n=+r[2];return n=n>30?0:1,t+o+n+" minutes"},e}(),searchController=new SearchController("/api/search/"),movieController=new MovieController("/api/movies/"),authController=new AuthController("/api/auth/"),movieApp=new App(searchController,movieController,authController);$("document").ready(movieApp.init);